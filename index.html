<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compare Substances in Water</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      background: #000;
      color: white;
    }
    .pair-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-bottom: 40px;
    }
    .simulation {
      margin: 20px;
    }
    .container {
      display: flex;
      justify-content: space-around;
    }
    .box {
      width: 250px;
      height: 300px;
      border: 2px solid #0288d1;
      background-color: #ffffff;
      margin: 20px;
      position: relative;
      transition: opacity 0.8s ease, border-color 0.3s ease;
    }
    .dissolvedBox {
      background: #b3e5fc;
    }
    canvas {
      background: white;
    }
    select, button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #0288d1;
      color: white;
      cursor: pointer;
    }
    .label {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .highlight {
      border-color: #00c853 !important;
    }
    .instructions {
      font-style: italic;
      margin-bottom: 10px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>Compare Substances in Water</h1>
  <p class="instructions">Drag each solid into the water to see the ions dissociate.</p>

  <div class="pair-container">
    <div class="simulation" id="sim1"></div>
    <div class="simulation" id="sim2"></div>
  </div>

  <script>
    const compounds = [
      { value: "Na2CO3", text: "Sodium Carbonate (Na₂CO₃)" },
      { value: "NaCl", text: "Sodium Chloride (NaCl)" },
      { value: "CaCl2", text: "Calcium Chloride (CaCl₂)" },
      { value: "CaCO3", text: "Calcium Carbonate (CaCO₃)" },
      { value: "MgSO4", text: "Magnesium Sulfate (MgSO₄)" },
      { value: "MgCl2", text: "Magnesium Chloride (MgCl₂)" },
      { value: "Na2SO4", text: "Sodium Sulfate (Na₂SO₄)" }
    ];

    function createSimulation(idSuffix) {
      const simDiv = document.getElementById(idSuffix);
      simDiv.innerHTML = `
        <h2>Option ${idSuffix === 'sim1' ? '1' : '2'}</h2>
        <select id="compoundSelect_${idSuffix}">${compounds.map(c => `<option value="${c.value}">${c.text}</option>`).join('')}</select>
        <button onclick="resetSimulation('${idSuffix}')">Reset</button>
        <div class="container">
          <div>
            <div class="label">Solid</div>
            <div class="box" id="solidBoxContainer_${idSuffix}" draggable="true">
              <canvas id="solidBox_${idSuffix}" width="250" height="300"></canvas>
            </div>
          </div>
          <div>
            <div class="label">In Water</div>
            <div class="box dissolvedBox" id="dissolvedBoxContainer_${idSuffix}"
              ondragover="event.preventDefault()"
              ondragenter="this.classList.add('highlight')"
              ondragleave="this.classList.remove('highlight')"
              ondrop="handleDrop(event, '${idSuffix}')">
              <canvas id="dissolvedBox_${idSuffix}" width="250" height="300"></canvas>
            </div>
          </div>
        </div>
      `;
    }

    createSimulation("sim1");
    createSimulation("sim2");
  </script>

  <!-- Main logic -->
  <script>
    class Ion {
      constructor(label, x, y, color) {
        this.label = label;
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.color = color;
        this.moving = false;
      }

      update() {
        if (this.moving) {
          this.x += this.vx;
          this.y += this.vy;
          if (this.x < 20 || this.x > 230) this.vx *= -1;
          if (this.y < 20 || this.y > 280) this.vy *= -1;
        }
      }

      draw(ctx) {
        ctx.beginPath();
        ctx.arc(this.x, this.y, 20, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.strokeStyle = '#000';
        ctx.stroke();
        ctx.fillStyle = '#000';
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(this.label, this.x, this.y + 5);
      }
    }

    const simStates = {};

    function initSimulation(simId) {
      const solidCanvas = document.getElementById(`solidBox_${simId}`);
      const dissolvedCanvas = document.getElementById(`dissolvedBox_${simId}`);
      const solidCtx = solidCanvas.getContext('2d');
      const dissolvedCtx = dissolvedCanvas.getContext('2d');

      simStates[simId] = {
        solidCanvas,
        dissolvedCanvas,
        solidCtx,
        dissolvedCtx,
        solidIons: [],
        dissolvedIons: [],
        dissolved: false,
      };

      updateSolidDisplay(simId);
      animate(simId);

      document.getElementById(`compoundSelect_${simId}`).addEventListener("change", () => {
        resetSimulation(simId);
        updateSolidDisplay(simId);
      });

      document.getElementById(`solidBoxContainer_${simId}`).addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", "drop-allowed");
      });
    }

    function updateSolidDisplay(simId) {
      const state = simStates[simId];
      const compound = document.getElementById(`compoundSelect_${simId}`).value;
      const g = '#66bb6a', p = '#ab47bc';

      const ionsMap = {
        Na2CO3: [
          new Ion('Na⁺', 60, 100, g), new Ion('Na⁺', 90, 100, g),
          new Ion('CO₃²⁻', 75, 130, '#4db6ac')
        ],
        NaCl: [
          new Ion('Na⁺', 60, 100, g), new Ion('Cl⁻', 90, 100, p)
        ],
        CaCl2: [
          new Ion('Ca²⁺', 60, 100, '#a5d6a7'), new Ion('Cl⁻', 90, 100, p), new Ion('Cl⁻', 120, 100, p)
        ],
        CaCO3: [
          new Ion('Ca²⁺', 60, 100, '#a5d6a7'), new Ion('CO₃²⁻', 90, 100, '#4db6ac')
        ],
        MgSO4: [
          new Ion('Mg²⁺', 60, 100, '#90caf9'), new Ion('SO₄²⁻', 90, 100, 'yellow')
        ],
        MgCl2: [
          new Ion('Mg²⁺', 60, 100, '#90caf9'), new Ion('Cl⁻', 90, 100, p), new Ion('Cl⁻', 120, 100, p)
        ],
        Na2SO4: [
          new Ion('Na⁺', 60, 100, g), new Ion('Na⁺', 90, 100, g), new Ion('SO₄²⁻', 75, 130, 'yellow')
        ]
      };

      state.solidIons = ionsMap[compound] || [];
    }

    function handleDrop(event, simId) {
      event.preventDefault();
      event.currentTarget.classList.remove("highlight");
      const state = simStates[simId];
      if (!state.dissolved) {
        dissolve(simId);
        document.getElementById(`solidBoxContainer_${simId}`).style.opacity = "0.3";
      }
    }

    function dissolve(simId) {
      const state = simStates[simId];
      state.dissolved = true;
      const compound = document.getElementById(`compoundSelect_${simId}`).value;
      const g = '#66bb6a', p = '#ab47bc', speed = 0.5;

      const addIon = (label, color) => {
        const x = Math.random() * 210 + 20;
        const y = Math.random() * 260 + 20;
        const ion = new Ion(label, x, y, color);
        const angle = Math.random() * 2 * Math.PI;
        ion.vx = Math.cos(angle) * speed;
        ion.vy = Math.sin(angle) * speed;
        ion.moving = true;
        state.dissolvedIons.push(ion);
      };

      const dissolveMap = {
        Na2CO3: () => { for (let i = 0; i < 2; i++) addIon('Na⁺', g); for (let i = 0; i < 1; i++) addIon('CO₃²⁻', '#4db6ac'); },
        NaCl: () => { addIon('Na⁺', g); addIon('Cl⁻', p); },
        CaCl2: () => { addIon('Ca²⁺', '#a5d6a7'); addIon('Cl⁻', p); addIon('Cl⁻', p); },
        CaCO3: () => { addIon('Ca²⁺', '#a5d6a7'); addIon('CO₃²⁻', '#4db6ac'); },
        MgSO4: () => { addIon('Mg²⁺', '#90caf9'); addIon('SO₄²⁻', 'yellow'); },
        MgCl2: () => { addIon('Mg²⁺', '#90caf9'); addIon('Cl⁻', p); addIon('Cl⁻', p); },
        Na2SO4: () => { addIon('Na⁺', g); addIon('Na⁺', g); addIon('SO₄²⁻', 'yellow'); }
      };

      if (dissolveMap[compound]) dissolveMap[compound]();
    }

    function resetSimulation(simId) {
      const state = simStates[simId];
      state.dissolved = false;
      state.dissolvedIons = [];
      document.getElementById(`solidBoxContainer_${simId}`).style.opacity = "1";
    }

    function animate(simId) {
      const state = simStates[simId];
      state.solidCtx.clearRect(0, 0, 250, 300);
      state.dissolvedCtx.clearRect(0, 0, 250, 300);

      state.solidIons.forEach(ion => ion.draw(state.solidCtx));
      state.dissolvedIons.forEach(ion => {
        ion.update();
        ion.draw(state.dissolvedCtx);
      });

      requestAnimationFrame(() => animate(simId));
    }

    initSimulation("sim1");
    initSimulation("sim2");
  </script>
</body>
</html>
