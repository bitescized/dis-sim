<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Two Independent Ionic Simulations</title>
  <style>
    body {
      font-family: sans-serif;
      background: #000;
      color: white;
      text-align: center;
    }
    .sim-row {
      margin-bottom: 60px;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 10px;
    }
    .box {
      width: 250px;
      height: 300px;
      border: 2px solid #0288d1;
      background-color: #ffffff;
      transition: opacity 0.8s ease, border-color 0.3s ease;
    }
    .water-box {
      background: #b3e5fc;
    }
    canvas {
      background: white;
    }
    select, button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #0288d1;
      color: white;
      cursor: pointer;
    }
    .label {
      font-weight: bold;
      margin-top: 10px;
    }
    .highlight {
      border-color: #00c853 !important;
    }
  </style>
</head>
<body>

  <h1>Compare Two Ionic Dissolutions</h1>

  <!-- Simulation 1 -->
  <div class="sim-row" id="sim1">
    <h2>Simulation 1</h2>
    <select id="compoundSelect1"></select>
    <button onclick="resetSimulation('1')">Reset</button>
    <div class="container">
      <div>
        <div class="label">Solid</div>
        <div class="box" id="solidBoxContainer1" draggable="true">
          <canvas id="solidCanvas1" width="250" height="300"></canvas>
        </div>
      </div>
      <div>
        <div class="label">In Water</div>
        <div class="box water-box" id="dissolvedBoxContainer1"
             ondragover="event.preventDefault()"
             ondragenter="this.classList.add('highlight')"
             ondragleave="this.classList.remove('highlight')"
             ondrop="handleDrop('1')">
          <canvas id="dissolvedCanvas1" width="250" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation 2 -->
  <div class="sim-row" id="sim2">
    <h2>Simulation 2</h2>
    <select id="compoundSelect2"></select>
    <button onclick="resetSimulation('2')">Reset</button>
    <div class="container">
      <div>
        <div class="label">Solid</div>
        <div class="box" id="solidBoxContainer2" draggable="true">
          <canvas id="solidCanvas2" width="250" height="300"></canvas>
        </div>
      </div>
      <div>
        <div class="label">In Water</div>
        <div class="box water-box" id="dissolvedBoxContainer2"
             ondragover="event.preventDefault()"
             ondragenter="this.classList.add('highlight')"
             ondragleave="this.classList.remove('highlight')"
             ondrop="handleDrop('2')">
          <canvas id="dissolvedCanvas2" width="250" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    const compounds = {
      Na2CO3: [
        { type: 'solid', layout: [
          ['Na⁺', 60, 100, '#66bb6a'], ['Na⁺', 90, 100, '#66bb6a'],
          ['CO₃²⁻', 75, 130, '#4db6ac'], ['Na⁺', 130, 100, '#66bb6a'],
          ['Na⁺', 160, 100, '#66bb6a'], ['CO₃²⁻', 145, 130, '#4db6ac']
        ] },
        { type: 'dissolved', ions: [
          ['Na⁺', 4, '#66bb6a'], ['CO₃²⁻', 2, '#4db6ac']
        ] }
      ],
      NaCl: [
        { type: 'solid', layout: [
          ['Na⁺', 60, 100, '#66bb6a'], ['Cl⁻', 90, 100, '#ab47bc'],
          ['Na⁺', 120, 100, '#66bb6a'], ['Cl⁻', 150, 100, '#ab47bc'],
          ['Na⁺', 60, 160, '#66bb6a'], ['Cl⁻', 90, 160, '#ab47bc'],
          ['Na⁺', 120, 160, '#66bb6a'], ['Cl⁻', 150, 160, '#ab47bc']
        ] },
        { type: 'dissolved', ions: [
          ['Na⁺', 4, '#66bb6a'], ['Cl⁻', 4, '#ab47bc']
        ] }
      ],
      Na2SO4: [
        { type: 'solid', layout: [
          ['Na⁺', 60, 100, '#66bb6a'], ['Na⁺', 90, 100, '#66bb6a'],
          ['SO₄²⁻', 75, 130, 'yellow'], ['Na⁺', 130, 100, '#66bb6a'],
          ['Na⁺', 160, 100, '#66bb6a'], ['SO₄²⁻', 145, 130, 'yellow']
        ] },
        { type: 'dissolved', ions: [
          ['Na⁺', 4, '#66bb6a'], ['SO₄²⁻', 2, 'yellow']
        ] }
      ]
      // Add more compounds as needed
    };

    class Ion {
      constructor(label, x, y, color) {
        this.label = label;
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.color = color;
        this.moving = false;
      }

      update(canvas) {
        if (this.moving) {
          this.x += this.vx;
          this.y += this.vy;
          if (this.x < 20 || this.x > canvas.width - 20) this.vx *= -1;
          if (this.y < 20 || this.y > canvas.height - 20) this.vy *= -1;
        }
      }

      draw(ctx) {
        if (this.label === 'CO₃²⁻') {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'gray';
          ctx.fill(); ctx.stroke();
          [0, 120, 240].forEach(angle => {
            const rad = angle * Math.PI / 180;
            const ox = this.x + 15 * Math.cos(rad);
            const oy = this.y + 15 * Math.sin(rad);
            ctx.beginPath();
            ctx.arc(ox, oy, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill(); ctx.stroke();
          });
        } else if (this.label === 'SO₄²⁻') {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'yellow';
          ctx.fill(); ctx.stroke();
          [{dx:0,dy:-20}, {dx:20,dy:0}, {dx:0,dy:20}, {dx:-20,dy:0}].forEach(pos => {
            ctx.beginPath();
            ctx.arc(this.x + pos.dx, this.y + pos.dy, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill(); ctx.stroke();
          });
        } else {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 20, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill(); ctx.stroke();
        }
        ctx.fillStyle = '#000';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(this.label, this.x, this.y + 5);
      }
    }

    const simulations = {};

    function setupSimulation(id) {
      const select = document.getElementById(`compoundSelect${id}`);
      for (const compound in compounds) {
        const opt = document.createElement('option');
        opt.value = compound;
        opt.textContent = compound;
        select.appendChild(opt);
      }

      simulations[id] = {
        solidCtx: document.getElementById(`solidCanvas${id}`).getContext('2d'),
        dissolvedCtx: document.getElementById(`dissolvedCanvas${id}`).getContext('2d'),
        dissolvedCanvas: document.getElementById(`dissolvedCanvas${id}`),
        solidIons: [],
        dissolvedIons: [],
        dissolved: false,
        selected: select.value
      };

      select.addEventListener("change", () => {
        simulations[id].selected = select.value;
        resetSimulation(id);
        drawSolid(id);
      });

      document.getElementById(`solidBoxContainer${id}`).addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", "drop-allowed");
      });

      drawSolid(id);
      animate(id);
    }

    function drawSolid(id) {
      const sim = simulations[id];
      const layout = compounds[sim.selected][0].layout;
      sim.solidIons = layout.map(([label, x, y, color]) => new Ion(label, x, y, color));
    }

    function dissolve(id) {
      const sim = simulations[id];
      if (sim.dissolved) return;
      sim.dissolved = true;
      const ions = compounds[sim.selected][1].ions;
      ions.forEach(([label, count, color]) => {
        for (let i = 0; i < count; i++) {
          const angle = Math.random() * 2 * Math.PI;
          const ion = new Ion(label,
            Math.random() * 210 + 20,
            Math.random() * 260 + 20,
            color
          );
          ion.vx = Math.cos(angle) * 0.5;
          ion.vy = Math.sin(angle) * 0.5;
          ion.moving = true;
          sim.dissolvedIons.push(ion);
        }
      });
    }

    function handleDrop(id) {
      document.getElementById(`solidBoxContainer${id}`).style.opacity = 0.3;
      dissolve(id);
    }

    function resetSimulation(id) {
      const sim = simulations[id];
      sim.dissolved = false;
      sim.dissolvedIons = [];
      document.getElementById(`solidBoxContainer${id}`).style.opacity = 1;
      drawSolid(id);
    }

    function animate(id) {
      const sim = simulations[id];
      sim.solidCtx.clearRect(0, 0, 250, 300);
      sim.dissolvedCtx.clearRect(0, 0, 250, 300);
      sim.solidIons.forEach(ion => ion.draw(sim.solidCtx));
      sim.dissolvedIons.forEach(ion => {
        ion.update(sim.dissolvedCanvas);
        ion.draw(sim.dissolvedCtx);
      });
      requestAnimationFrame(() => animate(id));
    }

    setupSimulation("1");
    setupSimulation("2");
  </script>
</body>
</html>
