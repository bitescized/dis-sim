<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dual Substance Simulations</title>
  <style>
    body {
      font-family: sans-serif;
      background: #000;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .sim-container {
      margin-bottom: 60px;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 40px;
    }
    .box {
      width: 250px;
      height: 300px;
      border: 2px solid #0288d1;
      background-color: #ffffff;
      position: relative;
      transition: opacity 0.8s ease, border-color 0.3s ease;
    }
    .water-box {
      background: #b3e5fc;
    }
    canvas {
      background: white;
    }
    select, button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #0288d1;
      color: white;
      cursor: pointer;
    }
    .label {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .highlight {
      border-color: #00c853 !important;
    }
    .instructions {
      font-style: italic;
      margin-bottom: 10px;
      color: #ccc;
    }
  </style>
</head>
<body>

  <h1>Substance in Water - Dual Simulations</h1>

  <div id="sim1" class="sim-container">
    <p class="instructions">Simulation 1: Drag the solid into water to dissolve.</p>
    <select id="compoundSelect1"></select>
    <button onclick="resetSimulation('1')">Reset</button>
    <div class="container">
      <div>
        <div class="label">Solid</div>
        <div class="box" id="solidBoxContainer1" draggable="true">
          <canvas id="solidCanvas1" width="250" height="300"></canvas>
        </div>
      </div>
      <div>
        <div class="label">In Water</div>
        <div class="box water-box" id="dissolvedBoxContainer1"
             ondragover="event.preventDefault()"
             ondragenter="this.classList.add('highlight')"
             ondragleave="this.classList.remove('highlight')"
             ondrop="handleDrop('1')">
          <canvas id="dissolvedCanvas1" width="250" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div id="sim2" class="sim-container">
    <p class="instructions">Simulation 2: Drag the solid into water to dissolve.</p>
    <select id="compoundSelect2"></select>
    <button onclick="resetSimulation('2')">Reset</button>
    <div class="container">
      <div>
        <div class="label">Solid</div>
        <div class="box" id="solidBoxContainer2" draggable="true">
          <canvas id="solidCanvas2" width="250" height="300"></canvas>
        </div>
      </div>
      <div>
        <div class="label">In Water</div>
        <div class="box water-box" id="dissolvedBoxContainer2"
             ondragover="event.preventDefault()"
             ondragenter="this.classList.add('highlight')"
             ondragleave="this.classList.remove('highlight')"
             ondrop="handleDrop('2')">
          <canvas id="dissolvedCanvas2" width="250" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    const compounds = {
      Na2CO3: { ions: [["Na⁺", 4, "#66bb6a"], ["CO₃²⁻", 2, "#4db6ac"]] },
      NaCl: { ions: [["Na⁺", 4, "#66bb6a"], ["Cl⁻", 4, "#ab47bc"]] },
      CaCl2: { ions: [["Ca²⁺", 2, "#a5d6a7"], ["Cl⁻", 4, "#ab47bc"]] },
      CaCO3: { ions: [["Ca²⁺", 2, "#a5d6a7"], ["CO₃²⁻", 2, "#4db6ac"]] },
      MgSO4: { ions: [["Mg²⁺", 2, "#90caf9"], ["SO₄²⁻", 2, "yellow"]] },
      MgCl2: { ions: [["Mg²⁺", 2, "#90caf9"], ["Cl⁻", 4, "#ab47bc"]] },
      Na2SO4: { ions: [["Na⁺", 4, "#66bb6a"], ["SO₄²⁻", 2, "yellow"]] }
    };

    class Ion {
      constructor(label, x, y, color) {
        this.label = label;
        this.x = x;
        this.y = y;
        this.color = color;
        this.vx = 0;
        this.vy = 0;
        this.moving = false;
      }

      update(canvas) {
        if (this.moving) {
          this.x += this.vx;
          this.y += this.vy;
          if (this.x < 20 || this.x > canvas.width - 20) this.vx *= -1;
          if (this.y < 20 || this.y > canvas.height - 20) this.vy *= -1;
        }
      }

      draw(ctx) {
        if (this.label === 'CO₃²⁻') {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'gray';
          ctx.fill();
          ctx.stroke();
          [0, 120, 240].forEach(a => {
            const angle = a * Math.PI / 180;
            const ox = this.x + 15 * Math.cos(angle);
            const oy = this.y + 15 * Math.sin(angle);
            ctx.beginPath();
            ctx.arc(ox, oy, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.stroke();
          });
        } else if (this.label === 'SO₄²⁻') {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 8, 0, Math.PI * 2);
          ctx.fillStyle = 'yellow';
          ctx.fill();
          ctx.stroke();
          [{ dx: 0, dy: -20 }, { dx: 20, dy: 0 }, { dx: 0, dy: 20 }, { dx: -20, dy: 0 }].forEach(pos => {
            ctx.beginPath();
            ctx.arc(this.x + pos.dx, this.y + pos.dy, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.stroke();
          });
        } else {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 20, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.stroke();
        }
        ctx.fillStyle = '#000';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(this.label, this.x, this.y + 5);
      }
    }

    const simulations = {};

    function createSimulation(simId) {
      const select = document.getElementById(`compoundSelect${simId}`);
      Object.keys(compounds).forEach(key => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = key;
        select.appendChild(opt);
      });

      simulations[simId] = {
        solidCanvas: document.getElementById(`solidCanvas${simId}`),
        dissolvedCanvas: document.getElementById(`dissolvedCanvas${simId}`),
        solidCtx: document.getElementById(`solidCanvas${simId}`).getContext('2d'),
        dissolvedCtx: document.getElementById(`dissolvedCanvas${simId}`).getContext('2d'),
        solidIons: [],
        dissolvedIons: [],
        dissolved: false,
        selectedCompound: select.value
      };

      select.addEventListener("change", () => {
        simulations[simId].selectedCompound = select.value;
        resetSimulation(simId);
        updateSolidDisplay(simId);
      });

      document.getElementById(`solidBoxContainer${simId}`).addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", "drop-allowed");
      });

      updateSolidDisplay(simId);
      animate(simId);
    }

    function updateSolidDisplay(simId) {
      const sim = simulations[simId];
      sim.solidIons = [];
      const ions = compounds[sim.selectedCompound].ions;
      let x = 40, y = 60;
      ions.forEach(([label, count, color]) => {
        for (let i = 0; i < count; i++) {
          sim.solidIons.push(new Ion(label, x, y, color));
          x += 50;
          if (x > 200) { x = 40; y += 50; }
        }
      });
    }

    function dissolve(simId) {
      const sim = simulations[simId];
      if (sim.dissolved) return;
      sim.dissolved = true;
      const ions = compounds[sim.selectedCompound].ions;
      ions.forEach(([label, count, color]) => {
        for (let i = 0; i < count; i++) {
          const ion = new Ion(label,
            Math.random() * 210 + 20,
            Math.random() * 260 + 20,
            color
          );
          const angle = Math.random() * 2 * Math.PI;
          ion.vx = Math.cos(angle) * 0.5;
          ion.vy = Math.sin(angle) * 0.5;
          ion.moving = true;
          sim.dissolvedIons.push(ion);
        }
      });
    }

    function handleDrop(simId) {
      document.getElementById(`solidBoxContainer${simId}`).style.opacity = "0.3";
      dissolve(simId);
    }

    function resetSimulation(simId) {
      const sim = simulations[simId];
      sim.dissolved = false;
      sim.dissolvedIons = [];
      document.getElementById(`solidBoxContainer${simId}`).style.opacity = "1";
      updateSolidDisplay(simId);
    }

    function animate(simId) {
      const sim = simulations[simId];
      sim.solidCtx.clearRect(0, 0, 250, 300);
      sim.dissolvedCtx.clearRect(0, 0, 250, 300);
      sim.solidIons.forEach(ion => ion.draw(sim.solidCtx));
      sim.dissolvedIons.forEach(ion => {
        ion.update(sim.dissolvedCanvas);
        ion.draw(sim.dissolvedCtx);
      });
      requestAnimationFrame(() => animate(simId));
    }

    createSimulation('1');
    createSimulation('2');
  </script>
</body>
</html>
